<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Time-Series on CPU</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.7.1/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotlyjs-1.29.2/plotly-latest.min.js"></script>
<script src="site_libs/viz-0.3/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-0.9.2/grViz.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
  <div class="container">
  <div class="navbar-header">
  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
    <i class="fa fa-bars fa-lg fa-inverse"></i>
  </button>
  <a class="navbar-brand" href="index.html">MXNET R</a>
  </div>
  
  <div id="navbar" class="collapse navbar-collapse">
  <ul class="nav navbar-nav">
    
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Language Model<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="LanguageModel_GPU.html">GPU</a></li>
        <li><a href="LanguageModel_CPU.html">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">NLP Classification<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="NLP_Classification_GPU.html">GPU</a></li>
        <li><a href="NLP_Classification_CPU.html">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Time Series<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="TimeSeries_GPU">GPU</a></li>
        <li><a href="TimeSeries_CPU">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Translation<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="">GPU</a></li>
        <li><a href="">CPU</a></li>
        </ul>
  </li>
  
  <li><a href="CNN_NLP_Classification.html">CNN NLP Classification</a></li>
  
  </ul>
  
  <ul class="nav navbar-nav navbar-right">
    <li class=navbar-right><a href="mailto:nimus44@gmail.com" ><i class="fa fa-envelope fa-lg"></i></a></li>
    <li class=navbar-right><a href="https://github.com/jeremiedb" ><i class="fa fa-github fa-lg"></i></a></li>
  </ul>
  
  </div><!--/.nav-collapse -->
  </div><!--/.container -->
  </nav><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Time-Series on CPU</h1>

</div>


<p>This is a minimalistic demo on how to model time-series with RNN, including training and inference.</p>
<p>It relies on an explicit symbolic construction of the RNN cells (LSTM or GRU), thus supporting training on CPU unlike the FusedRNN operator that is CUDA dependent.</p>
<pre class="r"><code>library(&quot;readr&quot;)
library(&quot;dplyr&quot;)
library(&quot;plotly&quot;)
library(&quot;mxnet&quot;)</code></pre>
<div id="data-preparation" class="section level3">
<h3>Data preparation</h3>
<pre class="r"><code>seq_len = 100
samples = 192

seeds &lt;- runif(samples, min = -pi, max = pi)
pts &lt;- sapply(seeds, function(x) sin(x + pi/12 * (0:(seq_len))))

x &lt;- pts[1:seq_len, ]
x &lt;- array(x, dim = c(1, seq_len, samples))
y &lt;- pts[-1, ]

p1 = plot_ly(x = 1:dim(x)[2], y = x[1,,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[1,,2], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[1,,3], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[1,,4], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[1,,5], type = &quot;scatter&quot;, mode = &quot;lines&quot;)

p2 = plot_ly(x = 1:length(y[,1]), y = y[,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;%
  add_trace(x = 1:length(y[,2]), y = y[,2], type = &quot;scatter&quot;, mode = &quot;lines&quot;)

p1</code></pre>
<div id="2102cbd64d1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="2102cbd64d1">{"x":{"visdat":{"21064a3f305":["function () ","plotlyVisDat"]},"cur_data":"21064a3f305","attrs":{"21064a3f305":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.119362535024032,-0.141673324313635,-0.393054380725565,-0.617649430644124,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907408,-0.372264034855726,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644124,0.800152692578232,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514343,0.599796355907409,0.372264034855726,0.119362535024032,-0.141673324313634,-0.393054380725564,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.372264034855728,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644123,0.800152692578231,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514345,0.599796355907409,0.372264034855728,0.119362535024032,-0.141673324313634,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.37226403485573,-0.119362535024034,0.141673324313634,0.393054380725566,0.61764943064412,0.80015269257823,0.928126870827978,0.992850736632973,0.98991346549985,0.919515227602265,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907412,-0.37226403485573,-0.119362535024034,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123],"mode":"lines","alpha":1,"sizes":[10,100],"type":"scatter"},"21064a3f305.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.97125441542322,-0.876549449417021,-0.722109086999507,-0.518458183644667,-0.279475211867102,-0.0214464662554181,0.238043820589611,0.481311814447472,0.691779203556118,0.855102983161603,0.960152907589119,0.999769998092139,0.97125441542322,0.876549449417021,0.722109086999508,0.518458183644668,0.279475211867102,0.0214464662554184,-0.238043820589611,-0.481311814447472,-0.691779203556118,-0.855102983161603,-0.960152907589119,-0.999769998092139,-0.97125441542322,-0.876549449417021,-0.722109086999508,-0.518458183644668,-0.279475211867102,-0.0214464662554185,0.23804382058961,0.481311814447471,0.691779203556118,0.855102983161602,0.960152907589118,0.999769998092139,0.97125441542322,0.876549449417022,0.722109086999509,0.518458183644669,0.279475211867104,0.0214464662554204,-0.23804382058961,-0.481311814447471,-0.691779203556117,-0.855102983161602,-0.960152907589118,-0.999769998092139,-0.97125441542322,-0.876549449417022,-0.722109086999509,-0.518458183644669,-0.279475211867104,-0.0214464662554205,0.238043820589608,0.481311814447471,0.691779203556117,0.855102983161602,0.960152907589118,0.999769998092139,0.971254415423221,0.876549449417022,0.722109086999509,0.51845818364467,0.279475211867104,0.0214464662554189,-0.238043820589608,-0.48131181444747,-0.691779203556116,-0.855102983161602,-0.960152907589118,-0.999769998092139,-0.97125441542322,-0.876549449417023,-0.722109086999509,-0.51845818364467,-0.279475211867104,-0.021446466255419,0.238043820589608,0.48131181444747,0.691779203556116,0.855102983161602,0.960152907589117,0.999769998092139,0.97125441542322,0.876549449417023,0.722109086999509,0.518458183644671,0.279475211867104,0.0214464662554227,-0.238043820589608,-0.48131181444747,-0.691779203556116,-0.855102983161602,-0.960152907589117,-0.999769998092139,-0.97125441542322,-0.876549449417023,-0.722109086999509,-0.518458183644671],"mode":"lines","alpha":1,"sizes":[10,100],"type":"scatter"},"21064a3f305.2":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.98332138973214,-0.902742435751153,-0.760643076626138,-0.566707148851169,-0.334151065409837,-0.0788231390715702,0.181876453933028,0.430181467167142,0.649170324322303,0.823919296679583,0.942519530559166,0.996888616018311,0.98332138973214,0.902742435751153,0.760643076626138,0.566707148851169,0.334151065409838,0.078823139071571,-0.181876453933028,-0.430181467167142,-0.649170324322302,-0.823919296679583,-0.942519530559166,-0.996888616018311,-0.98332138973214,-0.902742435751154,-0.760643076626138,-0.56670714885117,-0.334151065409838,-0.0788231390715711,0.181876453933027,0.430181467167141,0.649170324322302,0.823919296679582,0.942519530559165,0.996888616018311,0.98332138973214,0.902742435751154,0.760643076626138,0.56670714885117,0.334151065409839,0.0788231390715721,-0.181876453933028,-0.430181467167141,-0.649170324322302,-0.823919296679582,-0.942519530559165,-0.996888616018311,-0.98332138973214,-0.902742435751154,-0.760643076626139,-0.56670714885117,-0.334151065409839,-0.0788231390715722,0.181876453933026,0.430181467167141,0.649170324322302,0.823919296679582,0.942519530559165,0.996888616018311,0.98332138973214,0.902742435751154,0.760643076626139,0.566707148851172,0.334151065409839,0.0788231390715706,-0.181876453933026,-0.430181467167141,-0.6491703243223,-0.823919296679582,-0.942519530559165,-0.996888616018311,-0.98332138973214,-0.902742435751155,-0.760643076626139,-0.566707148851172,-0.334151065409839,-0.0788231390715707,0.181876453933026,0.430181467167141,0.6491703243223,0.823919296679582,0.942519530559165,0.996888616018311,0.98332138973214,0.902742435751155,0.760643076626139,0.566707148851172,0.334151065409839,0.0788231390715744,-0.181876453933026,-0.430181467167141,-0.6491703243223,-0.823919296679582,-0.942519530559165,-0.996888616018311,-0.98332138973214,-0.902742435751155,-0.760643076626139,-0.566707148851172],"mode":"lines","alpha":1,"sizes":[10,100],"type":"scatter"},"21064a3f305.3":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.988388681827032,-0.99403686590852,-0.931943080301935,-0.806338913881532,-0.625784083018162,-0.402583101054198,-0.151946746053422,0.109044528587025,0.36260459880887,0.591453764854322,0.779996334248513,0.915383442468557,0.988388681827032,0.99403686590852,0.931943080301935,0.806338913881532,0.625784083018162,0.402583101054199,0.151946746053422,-0.109044528587025,-0.362604598808869,-0.591453764854322,-0.779996334248513,-0.915383442468556,-0.988388681827032,-0.99403686590852,-0.931943080301935,-0.806338913881532,-0.625784083018162,-0.402583101054199,-0.151946746053423,0.109044528587025,0.362604598808869,0.591453764854321,0.779996334248512,0.915383442468556,0.988388681827032,0.99403686590852,0.931943080301935,0.806338913881532,0.625784083018163,0.4025831010542,0.151946746053422,-0.109044528587025,-0.362604598808869,-0.591453764854321,-0.779996334248512,-0.915383442468556,-0.988388681827032,-0.99403686590852,-0.931943080301935,-0.806338913881532,-0.625784083018163,-0.4025831010542,-0.151946746053424,0.109044528587024,0.362604598808869,0.591453764854321,0.779996334248512,0.915383442468556,0.988388681827031,0.99403686590852,0.931943080301935,0.806338913881533,0.625784083018163,0.402583101054198,0.151946746053424,-0.109044528587024,-0.362604598808867,-0.591453764854321,-0.779996334248511,-0.915383442468556,-0.988388681827031,-0.994036865908521,-0.931943080301935,-0.806338913881534,-0.625784083018163,-0.402583101054198,-0.151946746053424,0.109044528587024,0.362604598808867,0.591453764854321,0.779996334248511,0.915383442468556,0.988388681827031,0.994036865908521,0.931943080301935,0.806338913881534,0.625784083018163,0.402583101054202,0.151946746053424,-0.109044528587024,-0.362604598808867,-0.591453764854321,-0.779996334248511,-0.915383442468556,-0.988388681827031,-0.994036865908521,-0.931943080301935,-0.806338913881534],"mode":"lines","alpha":1,"sizes":[10,100],"type":"scatter"},"21064a3f305.4":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.953048032957482,0.998949075930548,0.976773390220351,0.888032212160985,0.738773106385468,0.539167834290063,0.302819165304766,0.0458338706362812,-0.214274926572014,-0.459781241640485,-0.673954224915585,-0.842198341524705,-0.953048032957482,-0.998949075930548,-0.976773390220351,-0.888032212160986,-0.738773106385468,-0.539167834290064,-0.302819165304766,-0.0458338706362813,0.214274926572013,0.459781241640485,0.673954224915585,0.842198341524704,0.953048032957482,0.998949075930548,0.976773390220351,0.888032212160986,0.738773106385468,0.539167834290063,0.302819165304768,0.0458338706362814,-0.214274926572013,-0.459781241640484,-0.673954224915584,-0.842198341524704,-0.953048032957481,-0.998949075930548,-0.976773390220351,-0.888032212160986,-0.738773106385468,-0.539167834290065,-0.302819165304766,-0.0458338706362815,0.214274926572013,0.459781241640484,0.673954224915584,0.842198341524704,0.953048032957481,0.998949075930548,0.976773390220351,0.888032212160986,0.738773106385468,0.539167834290065,0.302819165304768,0.0458338706362817,-0.214274926572013,-0.459781241640484,-0.673954224915585,-0.842198341524704,-0.95304803295748,-0.998949075930548,-0.976773390220351,-0.888032212160987,-0.738773106385469,-0.539167834290063,-0.302819165304768,-0.0458338706362818,0.214274926572011,0.459781241640484,0.673954224915582,0.842198341524704,0.953048032957481,0.998949075930548,0.976773390220351,0.888032212160987,0.738773106385469,0.539167834290063,0.302819165304768,0.0458338706362819,-0.214274926572011,-0.459781241640484,-0.673954224915582,-0.842198341524703,-0.953048032957481,-0.998949075930548,-0.976773390220351,-0.888032212160987,-0.738773106385469,-0.539167834290067,-0.302819165304768,-0.045833870636282,0.214274926572011,0.459781241640484,0.673954224915582,0.842198341524703,0.953048032957481,0.998949075930548,0.976773390220351,0.888032212160987],"mode":"lines","alpha":1,"sizes":[10,100],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1]},"yaxis":{"domain":[0,1]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.119362535024032,-0.141673324313635,-0.393054380725565,-0.617649430644124,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907408,-0.372264034855726,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644124,0.800152692578232,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514343,0.599796355907409,0.372264034855726,0.119362535024032,-0.141673324313634,-0.393054380725564,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.372264034855728,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644123,0.800152692578231,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514345,0.599796355907409,0.372264034855728,0.119362535024032,-0.141673324313634,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.37226403485573,-0.119362535024034,0.141673324313634,0.393054380725566,0.61764943064412,0.80015269257823,0.928126870827978,0.992850736632973,0.98991346549985,0.919515227602265,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907412,-0.37226403485573,-0.119362535024034,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123],"mode":"lines","type":"scatter","line":{"fillcolor":"rgba(31,119,180,1)","color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.97125441542322,-0.876549449417021,-0.722109086999507,-0.518458183644667,-0.279475211867102,-0.0214464662554181,0.238043820589611,0.481311814447472,0.691779203556118,0.855102983161603,0.960152907589119,0.999769998092139,0.97125441542322,0.876549449417021,0.722109086999508,0.518458183644668,0.279475211867102,0.0214464662554184,-0.238043820589611,-0.481311814447472,-0.691779203556118,-0.855102983161603,-0.960152907589119,-0.999769998092139,-0.97125441542322,-0.876549449417021,-0.722109086999508,-0.518458183644668,-0.279475211867102,-0.0214464662554185,0.23804382058961,0.481311814447471,0.691779203556118,0.855102983161602,0.960152907589118,0.999769998092139,0.97125441542322,0.876549449417022,0.722109086999509,0.518458183644669,0.279475211867104,0.0214464662554204,-0.23804382058961,-0.481311814447471,-0.691779203556117,-0.855102983161602,-0.960152907589118,-0.999769998092139,-0.97125441542322,-0.876549449417022,-0.722109086999509,-0.518458183644669,-0.279475211867104,-0.0214464662554205,0.238043820589608,0.481311814447471,0.691779203556117,0.855102983161602,0.960152907589118,0.999769998092139,0.971254415423221,0.876549449417022,0.722109086999509,0.51845818364467,0.279475211867104,0.0214464662554189,-0.238043820589608,-0.48131181444747,-0.691779203556116,-0.855102983161602,-0.960152907589118,-0.999769998092139,-0.97125441542322,-0.876549449417023,-0.722109086999509,-0.51845818364467,-0.279475211867104,-0.021446466255419,0.238043820589608,0.48131181444747,0.691779203556116,0.855102983161602,0.960152907589117,0.999769998092139,0.97125441542322,0.876549449417023,0.722109086999509,0.518458183644671,0.279475211867104,0.0214464662554227,-0.238043820589608,-0.48131181444747,-0.691779203556116,-0.855102983161602,-0.960152907589117,-0.999769998092139,-0.97125441542322,-0.876549449417023,-0.722109086999509,-0.518458183644671],"mode":"lines","type":"scatter","line":{"fillcolor":"rgba(255,127,14,1)","color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.98332138973214,-0.902742435751153,-0.760643076626138,-0.566707148851169,-0.334151065409837,-0.0788231390715702,0.181876453933028,0.430181467167142,0.649170324322303,0.823919296679583,0.942519530559166,0.996888616018311,0.98332138973214,0.902742435751153,0.760643076626138,0.566707148851169,0.334151065409838,0.078823139071571,-0.181876453933028,-0.430181467167142,-0.649170324322302,-0.823919296679583,-0.942519530559166,-0.996888616018311,-0.98332138973214,-0.902742435751154,-0.760643076626138,-0.56670714885117,-0.334151065409838,-0.0788231390715711,0.181876453933027,0.430181467167141,0.649170324322302,0.823919296679582,0.942519530559165,0.996888616018311,0.98332138973214,0.902742435751154,0.760643076626138,0.56670714885117,0.334151065409839,0.0788231390715721,-0.181876453933028,-0.430181467167141,-0.649170324322302,-0.823919296679582,-0.942519530559165,-0.996888616018311,-0.98332138973214,-0.902742435751154,-0.760643076626139,-0.56670714885117,-0.334151065409839,-0.0788231390715722,0.181876453933026,0.430181467167141,0.649170324322302,0.823919296679582,0.942519530559165,0.996888616018311,0.98332138973214,0.902742435751154,0.760643076626139,0.566707148851172,0.334151065409839,0.0788231390715706,-0.181876453933026,-0.430181467167141,-0.6491703243223,-0.823919296679582,-0.942519530559165,-0.996888616018311,-0.98332138973214,-0.902742435751155,-0.760643076626139,-0.566707148851172,-0.334151065409839,-0.0788231390715707,0.181876453933026,0.430181467167141,0.6491703243223,0.823919296679582,0.942519530559165,0.996888616018311,0.98332138973214,0.902742435751155,0.760643076626139,0.566707148851172,0.334151065409839,0.0788231390715744,-0.181876453933026,-0.430181467167141,-0.6491703243223,-0.823919296679582,-0.942519530559165,-0.996888616018311,-0.98332138973214,-0.902742435751155,-0.760643076626139,-0.566707148851172],"mode":"lines","type":"scatter","line":{"fillcolor":"rgba(44,160,44,1)","color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.988388681827032,-0.99403686590852,-0.931943080301935,-0.806338913881532,-0.625784083018162,-0.402583101054198,-0.151946746053422,0.109044528587025,0.36260459880887,0.591453764854322,0.779996334248513,0.915383442468557,0.988388681827032,0.99403686590852,0.931943080301935,0.806338913881532,0.625784083018162,0.402583101054199,0.151946746053422,-0.109044528587025,-0.362604598808869,-0.591453764854322,-0.779996334248513,-0.915383442468556,-0.988388681827032,-0.99403686590852,-0.931943080301935,-0.806338913881532,-0.625784083018162,-0.402583101054199,-0.151946746053423,0.109044528587025,0.362604598808869,0.591453764854321,0.779996334248512,0.915383442468556,0.988388681827032,0.99403686590852,0.931943080301935,0.806338913881532,0.625784083018163,0.4025831010542,0.151946746053422,-0.109044528587025,-0.362604598808869,-0.591453764854321,-0.779996334248512,-0.915383442468556,-0.988388681827032,-0.99403686590852,-0.931943080301935,-0.806338913881532,-0.625784083018163,-0.4025831010542,-0.151946746053424,0.109044528587024,0.362604598808869,0.591453764854321,0.779996334248512,0.915383442468556,0.988388681827031,0.99403686590852,0.931943080301935,0.806338913881533,0.625784083018163,0.402583101054198,0.151946746053424,-0.109044528587024,-0.362604598808867,-0.591453764854321,-0.779996334248511,-0.915383442468556,-0.988388681827031,-0.994036865908521,-0.931943080301935,-0.806338913881534,-0.625784083018163,-0.402583101054198,-0.151946746053424,0.109044528587024,0.362604598808867,0.591453764854321,0.779996334248511,0.915383442468556,0.988388681827031,0.994036865908521,0.931943080301935,0.806338913881534,0.625784083018163,0.402583101054202,0.151946746053424,-0.109044528587024,-0.362604598808867,-0.591453764854321,-0.779996334248511,-0.915383442468556,-0.988388681827031,-0.994036865908521,-0.931943080301935,-0.806338913881534],"mode":"lines","type":"scatter","line":{"fillcolor":"rgba(214,39,40,1)","color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.953048032957482,0.998949075930548,0.976773390220351,0.888032212160985,0.738773106385468,0.539167834290063,0.302819165304766,0.0458338706362812,-0.214274926572014,-0.459781241640485,-0.673954224915585,-0.842198341524705,-0.953048032957482,-0.998949075930548,-0.976773390220351,-0.888032212160986,-0.738773106385468,-0.539167834290064,-0.302819165304766,-0.0458338706362813,0.214274926572013,0.459781241640485,0.673954224915585,0.842198341524704,0.953048032957482,0.998949075930548,0.976773390220351,0.888032212160986,0.738773106385468,0.539167834290063,0.302819165304768,0.0458338706362814,-0.214274926572013,-0.459781241640484,-0.673954224915584,-0.842198341524704,-0.953048032957481,-0.998949075930548,-0.976773390220351,-0.888032212160986,-0.738773106385468,-0.539167834290065,-0.302819165304766,-0.0458338706362815,0.214274926572013,0.459781241640484,0.673954224915584,0.842198341524704,0.953048032957481,0.998949075930548,0.976773390220351,0.888032212160986,0.738773106385468,0.539167834290065,0.302819165304768,0.0458338706362817,-0.214274926572013,-0.459781241640484,-0.673954224915585,-0.842198341524704,-0.95304803295748,-0.998949075930548,-0.976773390220351,-0.888032212160987,-0.738773106385469,-0.539167834290063,-0.302819165304768,-0.0458338706362818,0.214274926572011,0.459781241640484,0.673954224915582,0.842198341524704,0.953048032957481,0.998949075930548,0.976773390220351,0.888032212160987,0.738773106385469,0.539167834290063,0.302819165304768,0.0458338706362819,-0.214274926572011,-0.459781241640484,-0.673954224915582,-0.842198341524703,-0.953048032957481,-0.998949075930548,-0.976773390220351,-0.888032212160987,-0.738773106385469,-0.539167834290067,-0.302819165304768,-0.045833870636282,0.214274926572011,0.459781241640484,0.673954224915582,0.842198341524703,0.953048032957481,0.998949075930548,0.976773390220351,0.888032212160987],"mode":"lines","type":"scatter","line":{"fillcolor":"rgba(148,103,189,1)","color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
</div>
<div id="create-data-iterators" class="section level3">
<h3>Create data iterators</h3>
<pre class="r"><code>batch.size = 16

train.data &lt;- mx.io.arrayiter(data = x[,,1:160, drop = F], label = y[, 1:160], 
                              batch.size = batch.size, shuffle = TRUE)

eval.data &lt;- mx.io.arrayiter(data = x[,,-(1:160), drop = F], label = y[, -(1:160)], 
                              batch.size = batch.size, shuffle = FALSE)</code></pre>
</div>
<div id="model-architecture" class="section level3">
<h3>Model architecture</h3>
<pre class="r"><code>symbol &lt;- rnn.graph.unroll(seq_len = 2, 
                           num_rnn_layer =  1, 
                           num_hidden = 50,
                           input_size = NULL,
                           num_embed = NULL, 
                           num_decode = 1,
                           masking = F, 
                           loss_output = &quot;linear&quot;,
                           dropout = 0.2, 
                           ignore_label = -1,
                           cell_type = &quot;lstm&quot;,
                           output_last_state = F,
                           config = &quot;one-to-one&quot;)

graph = graph.viz(symbol, type = &quot;graph&quot;, direction = &quot;TD&quot;, 
                  shape=list(data = c(1, 2, batch.size), 
                             label = c(2, batch.size)))</code></pre>
<div id="htmlwidget-a3083d15c9866036dd62" style="width:672px;height:1152px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a3083d15c9866036dd62">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TD\"]\n\n\n  \"1\" [label = \"data\ndata\", shape = \"oval\", penwidth = \"2\", color = \"#8dd3c7\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#8DD3C7FF\"] \n  \"2\" [label = \"SwapAxis\nswap_pre\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"3\" [label = \"SliceChannel\nsplit0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"4\" [label = \"FullyConnected\nt1.l1.i2h\n200\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"5\" [label = \"SliceChannel\nt1.l1.slice\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"6\" [label = \"Activation\nactivation3\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"7\" [label = \"Activation\nactivation0\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"8\" [label = \"Activation\nactivation1\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"9\" [label = \"elemwise_mul\n_mul0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"10\" [label = \"Activation\nactivation4\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"11\" [label = \"elemwise_mul\n_mul1\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"12\" [label = \"FullyConnected\nt2.l1.i2h\n200\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"13\" [label = \"FullyConnected\nt2.l1.h2h\n200\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"14\" [label = \"elemwise_add\n_plus0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"15\" [label = \"SliceChannel\nt2.l1.slice\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"16\" [label = \"Activation\nactivation8\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"17\" [label = \"Activation\nactivation7\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"18\" [label = \"elemwise_mul\n_mul2\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"19\" [label = \"Activation\nactivation5\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"20\" [label = \"Activation\nactivation6\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"21\" [label = \"elemwise_mul\n_mul3\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"22\" [label = \"elemwise_add\n_plus1\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"23\" [label = \"Activation\nactivation9\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"24\" [label = \"elemwise_mul\n_mul4\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"25\" [label = \"Concat\nconcat\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"26\" [label = \"Reshape\nrnn_reshape\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"27\" [label = \"_copy\nmask\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"28\" [label = \"SwapAxis\nswap_post\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"29\" [label = \"Reshape\nreshape0\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"30\" [label = \"FullyConnected\ndecode\n1\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"31\" [label = \"Reshape\nreshape1\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"32\" [label = \"LinearRegressionOutput\nloss\", shape = \"box\", penwidth = \"2\", color = \"#b3de69\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#B3DE69FF\"] \n\"1\"->\"2\" [id = \"1\", color = \"black\", fontcolor = \"black\", label = \"1X2X16\"] \n\"2\"->\"3\" [id = \"2\", color = \"black\", fontcolor = \"black\", label = \"1X16X2\"] \n\"3\"->\"4\" [id = \"3\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"4\"->\"5\" [id = \"4\", color = \"black\", fontcolor = \"black\", label = \"200X16\"] \n\"5\"->\"6\" [id = \"5\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"5\"->\"7\" [id = \"6\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"5\"->\"8\" [id = \"7\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"7\"->\"9\" [id = \"8\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"8\"->\"9\" [id = \"9\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"9\"->\"10\" [id = \"10\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"6\"->\"11\" [id = \"11\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"10\"->\"11\" [id = \"12\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"3\"->\"12\" [id = \"13\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"11\"->\"13\" [id = \"14\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"12\"->\"14\" [id = \"15\", color = \"black\", fontcolor = \"black\", label = \"200X16\"] \n\"13\"->\"14\" [id = \"16\", color = \"black\", fontcolor = \"black\", label = \"200X16\"] \n\"14\"->\"15\" [id = \"17\", color = \"black\", fontcolor = \"black\", label = \"200X16\"] \n\"15\"->\"16\" [id = \"18\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"15\"->\"17\" [id = \"19\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"17\"->\"18\" [id = \"20\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"9\"->\"18\" [id = \"21\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"15\"->\"19\" [id = \"22\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"15\"->\"20\" [id = \"23\", color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"19\"->\"21\" [id = \"24\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"20\"->\"21\" [id = \"25\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"18\"->\"22\" [id = \"26\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"21\"->\"22\" [id = \"27\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"22\"->\"23\" [id = \"28\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"16\"->\"24\" [id = \"29\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"23\"->\"24\" [id = \"30\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"11\"->\"25\" [id = \"31\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"24\"->\"25\" [id = \"32\", color = \"black\", fontcolor = \"black\", label = \"50X16\"] \n\"25\"->\"26\" [id = \"33\", color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"26\"->\"27\" [id = \"34\", color = \"black\", fontcolor = \"black\", label = \"50X16X2\"] \n\"27\"->\"28\" [id = \"35\", color = \"black\", fontcolor = \"black\", label = \"50X16X2\"] \n\"28\"->\"29\" [id = \"36\", color = \"black\", fontcolor = \"black\", label = \"50X2X16\"] \n\"29\"->\"30\" [id = \"37\", color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"30\"->\"32\" [id = \"38\", color = \"black\", fontcolor = \"black\", label = \"1X32\"] \n\"31\"->\"32\" [id = \"39\", color = \"black\", fontcolor = \"black\", label = \"32\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="fit-a-lstm-model" class="section level3">
<h3>Fit a LSTM model</h3>
<p>Needs a custom metric to handle labels in a matrix rather than flat format in the iterator.</p>
<pre class="r"><code>mx.metric.mse.seq &lt;- mx.metric.custom(&quot;Perplexity&quot;, function(label, pred) {
  label = mx.nd.reshape(mx.nd.array(label), shape = -1)
  label = as.array(label)
  res &lt;- mean((label-pred)^2)
  return(res)
})</code></pre>
<pre class="r"><code>ctx &lt;- mx.cpu()

initializer &lt;- mx.init.Xavier(rnd_type = &quot;gaussian&quot;, 
                              factor_type = &quot;avg&quot;, 
                              magnitude = 2.5)

optimizer &lt;- mx.opt.create(&quot;adadelta&quot;, rho = 0.9, eps = 1e-5, wd = 1e-6,
                           clip_gradient = 1, rescale.grad = 1/batch.size)

logger &lt;- mx.metric.logger()
epoch.end.callback &lt;- mx.callback.log.train.metric(period = 10, logger = logger)

system.time(
  model &lt;- mx.model.buckets(symbol = symbol,
                            train.data = train.data, 
                            eval.data = eval.data, 
                            num.round = 250, ctx = ctx, verbose = TRUE,
                            metric = mx.metric.mse.seq, 
                            initializer = initializer, optimizer = optimizer, 
                            batch.end.callback = NULL, 
                            epoch.end.callback = epoch.end.callback)
)</code></pre>
<pre><code>##    user  system elapsed 
## 502.770 710.730 304.278</code></pre>
<pre class="r"><code>plot_ly(x = seq_len(length(logger$train)), y = logger$train, type = &quot;scatter&quot;, 
        mode = &quot;markers+lines&quot;, name = &quot;train&quot;) %&gt;% 
  add_trace(y = logger$eval, type = &quot;scatter&quot;, 
            mode = &quot;markers+lines&quot;, name = &quot;eval&quot;)</code></pre>
<div id="21036d08a55" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="21036d08a55">{"x":{"visdat":{"210694fedce":["function () ","plotlyVisDat"]},"cur_data":"210694fedce","attrs":{"210694fedce":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250],"y":[0.265544641039842,0.082545313737411,0.0490648400928606,0.0297429605618508,0.0360844727861723,0.0280124246936276,0.0287282673402177,0.0246209591416104,0.0231623268661192,0.0235745037941668,0.019585457150271,0.0243062356489799,0.0143814953731778,0.014147834613636,0.0169520113777071,0.0171632481851458,0.0136340526769163,0.0147214987411443,0.011924251242889,0.0139956837286748,0.0105426218279829,0.0104825057661282,0.0125827824865109,0.00938455121008978,0.011083517178446,0.0108355421972353,0.0106034316005537,0.007951358500064,0.0104305319120703,0.00984764605139797,0.00905206986408543,0.00814223365954097,0.00736867944968346,0.00990181952708613,0.00881554516887922,0.00731246044524206,0.00694695202635282,0.0096613013284905,0.00736824916742456,0.00660680065544221,0.00817191220964427,0.00678686566699899,0.00758039542221011,0.00715763340762353,0.00636618640719721,0.00730898628332969,0.00684089599051735,0.00742401846161594,0.005941767327289,0.00608850244891824,0.00595796063964804,0.00779806638343764,0.00650685924016613,0.00588503321263015,0.00595204408101766,0.00629742328220161,0.00595566211053992,0.00584537239969455,0.00595638621294384,0.00560624637939506,0.00614083990696177,0.00542095758469916,0.00623934445580201,0.00527447890857099,0.00577418192182772,0.00529356202465082,0.00624484328086327,0.00523579012660837,0.00536483481952178,0.00494825657963475,0.00553478234534597,0.00524154909087658,0.0054762173606113,0.00501766640246483,0.00574295389297475,0.00505262651327578,0.00510036947621161,0.0047753866199714,0.00542404601090004,0.00481844016514642,0.00498907233350311,0.00468955744346129,0.00562792069847776,0.00486203075429002,0.00478589284221612,0.0045109548011153,0.00477727910668301,0.00504041833417298,0.00505844434786741,0.00445049671460206,0.00443924382802188,0.00474086537305229,0.00483476629361212,0.00475982892017534,0.00462218799549136,0.00457602072511713,0.00469537456918458,0.00435891338319772,0.00413371177447397,0.00468450513302589,0.00458550170050849,0.00492134495779961,0.00430327438164757,0.00448999828679961,0.0044614959605457,0.00444577908866546,0.00457797998154605,0.00421859517134749,0.0044758916409948,0.00432500518240517,0.00452426119141545,0.00429460202867681,0.00410616812780168,0.00442259129455904,0.00428799103989442,0.00419567960201143,0.00404635278994382,0.0042554948654919,0.00426735679893215,0.00416148323295657,0.00425869498051889,0.00422440201973463,0.00427972420963812,0.00423143208263865,0.00419641744595075,0.00409322075729349,0.00399081850889509,0.00444732178879009,0.00422331689431231,0.00408304997574897,0.00384066173141496,0.00397747592331097,0.00389351598679403,0.00401665817765628,0.0043025618123346,0.00414770051343982,0.00397698065958387,0.0048432556680061,0.00399742478126932,0.00372033339696221,0.00387425351787307,0.0041795130579477,0.00414666067775917,0.00453191764188405,0.00393652646964376,0.00387018644410923,0.00395973772608969,0.00393015745877353,0.00415437992841487,0.00382933470992191,0.0039716679840918,0.00396824920942686,0.00387720219926164,0.00390981839000382,0.00393403575344994,0.00400911152824456,0.00400428233275916,0.00410108797942429,0.00389587347791116,0.00410553253121395,0.00396849244418826,0.0039311613972831,0.0037751492481285,0.00369997445297613,0.00377118487646125,0.00395259752678043,0.00381772147934758,0.00394082444288075,0.00388465685945041,0.00375244315575771,0.00406008117671502,0.00379708664982422,0.00392388186823391,0.00373307086378985,0.00384811372148741,0.00375068091440866,0.00372059205998941,0.00399466736001566,0.00363512482761507,0.00391485419686484,0.00368820865268166,0.00366863626487896,0.00384054675727543,0.00393853595194595,0.0037268812904598,0.0038427928239601,0.00383807155374231,0.00374185560603772,0.00386633254827541,0.00370741683570314,0.00380710532992585,0.00360314981979589,0.00382845572788622,0.00378567651607456,0.00371504565701272,0.00375344787070957,0.00349840982111328,0.0036235098967868,0.00382352744452885,0.00387271559498584,0.0039850801128826,0.00369409574921024,0.00365402948740282,0.00356916834180024,0.003997670298266,0.00384850653112125,0.00375974113946744,0.00370689678198061,0.0035314564775711,0.0037728033925681,0.00371177593211664,0.00393531421706984,0.00349463113877538,0.00354997041008099,0.00363850304614584,0.00380225967133687,0.0037029578549787,0.00371205559827275,0.0036784776446341,0.00375118543979186,0.00369031987779686,0.00358394785152742,0.00355048591269601,0.00360803100878992,0.0038628290637094,0.00355930661319937,0.00357286880581381,0.00347757594170552,0.00359404884654308,0.00359704705243565,0.00355282380924421,0.00356784624245701,0.0037609879225256,0.00406416638612581,0.00401284667494191,0.00372135175036096,0.0035699176284499,0.00347955397123019,0.0035688708706609,0.00361850670512855,0.00348924856712853,0.00346169060084027,0.00339090465904398,0.00380684639959759,0.00389129219592492,0.00379656606813314,0.003638682281994,0.00362379963425109,0.00388079058084213,0.00345223995052029],"mode":"markers+lines","name":"train","alpha":1,"sizes":[10,100],"type":"scatter"},"210694fedce.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250],"y":[0.113130182515766,0.0444057257200802,0.0338218030084468,0.0337244120276592,0.027331536401767,0.0364557297141497,0.0157365234755445,0.0291692470492813,0.0235388943375963,0.016200669220665,0.0135053610686114,0.0119417633101341,0.00908138040480939,0.0180051426750421,0.0133253474656483,0.0139230545127173,0.0104116877098221,0.0161815621687389,0.0125230169414216,0.0106743122957257,0.00760007130117398,0.0143167004562888,0.0099035017282418,0.00850743700960419,0.00717878109301368,0.00932246191889959,0.00590738908806426,0.00621336159330416,0.0100953698511723,0.00734541487401999,0.00638536928401718,0.00652404895057058,0.00586827295124329,0.0100054315727589,0.0061083025121723,0.00599097981639381,0.00755202676831397,0.00583035139858034,0.00525141097151998,0.00542777025330286,0.00662804129684707,0.00475702075120482,0.0062491231311548,0.0053191991373578,0.00509747187379533,0.00540304841949387,0.00773470320342814,0.00488077097617871,0.00396682598821736,0.00481351257090104,0.00472614678102596,0.00710446645989411,0.00461329800898867,0.0051235838847148,0.00438369798100991,0.00580310844613587,0.00440549986376286,0.00570570041650452,0.00450401735656085,0.00621462016155515,0.0045844218878354,0.00579371628051257,0.00419412402165897,0.00410679536742282,0.00489720166851241,0.00430854848765894,0.0045834147920086,0.00414083012143214,0.0042575186627892,0.00438880844402387,0.00414000583374672,0.00436463447736572,0.00459588464141527,0.00419612045676621,0.00439515595620508,0.00479609852417636,0.0042723162559345,0.00409072977901828,0.00405593545176247,0.00410706908214842,0.00439099791108274,0.00387494988034584,0.00439228765373238,0.00399355074141957,0.00401882410493663,0.00366608608026613,0.00416154603545796,0.00429604800256609,0.00408634602138072,0.0036457710327475,0.0038686886909912,0.00346111863093953,0.00388235457257204,0.00387680105018709,0.00399573653650492,0.00382560213946689,0.00337296962423323,0.00372184353267049,0.00346486367434406,0.00397117702628571,0.00400618186329312,0.00380622913511325,0.00361856206184005,0.00377892771919154,0.00342203892918399,0.00406181423739448,0.00391573619066277,0.00327974044037212,0.00354338683975253,0.00385348058759944,0.00402818529869423,0.00345991293438781,0.00388654259999157,0.00339701492761596,0.00394133561925466,0.00333588686899319,0.00355539058167544,0.00341764174424356,0.00350320748511084,0.00362308836579378,0.00350471760626365,0.00315726500655526,0.00418935744581234,0.00357727754711535,0.00377469891027906,0.0032124473684468,0.00309793966649679,0.00400174808986976,0.00378790080931198,0.00319997678876343,0.00323269067461629,0.00327772157531511,0.00331256283992193,0.00396710460445582,0.00349006494403496,0.00352518252591228,0.00438439671334852,0.0033155192813655,0.00305584117067606,0.00308171310668691,0.00372226059455552,0.00414834133234933,0.0036536045417273,0.00326043397461808,0.00311625598944648,0.00325446621411817,0.00352779959533281,0.00349385066837333,0.00306241084715043,0.00310679940165032,0.00374772846732092,0.00318451340979581,0.00329561744235117,0.00330606148911825,0.00328602631159355,0.00356142912660462,0.0036566178696882,0.00298016473506014,0.00346005558228419,0.00387039451806239,0.003509293810439,0.00298505193366807,0.00308524231898947,0.00334737252893034,0.00331846410592868,0.00330092487563198,0.00332656265570132,0.0033720732555423,0.00335066726197344,0.00344379536055083,0.00312609378824259,0.00324478291796488,0.00355237458124654,0.00328325497746058,0.00298604643536463,0.0032389572100504,0.00394479379918898,0.00328576302131741,0.00343318496765189,0.0032109902348282,0.00307284749841439,0.00316588677773783,0.00345901292039913,0.00298842881271187,0.00336015376349717,0.00347437508324957,0.00334728942972399,0.00336315130138531,0.00352460209669757,0.0032865606651712,0.00339919040400945,0.00296591406744895,0.00333414175891829,0.00297110603255923,0.00342042933304478,0.00317143301693886,0.00297967699078887,0.00314434327325191,0.0031284324680681,0.00347351356675499,0.00346520464189259,0.0033189482529334,0.00330445941450954,0.00302716074080892,0.00331388459419681,0.00301531240399274,0.00334383082762795,0.00319390918530469,0.00324831062057816,0.00349794170534417,0.0030113330657014,0.00292862572725525,0.00302644708398229,0.00306803241079014,0.00305794025934832,0.00375350200255442,0.00347036088909677,0.0030349994790851,0.00291210345186323,0.00314275899766009,0.00324303559264062,0.00310634545764647,0.00305659554191634,0.00306083135925001,0.00297573860504961,0.00298781143941616,0.00293716110535653,0.00313474030756598,0.0033867360277322,0.00310669568716213,0.00302639104400015,0.00303997239733585,0.00375164709368625,0.00362943862941238,0.00342383155249971,0.00292799241341045,0.00300734343217194,0.00279084925786007,0.00319735809568368,0.00289800849230057,0.00291770640086851,0.0029085394475791,0.00337176571889986,0.00364597939504492,0.00371845556500285,0.00326496243670963,0.00349652030391568,0.00315407799410295,0.00304888271552164,0.00294715372065976],"mode":"markers+lines","name":"eval","alpha":1,"sizes":[10,100],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1]},"yaxis":{"domain":[0,1]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250],"y":[0.265544641039842,0.082545313737411,0.0490648400928606,0.0297429605618508,0.0360844727861723,0.0280124246936276,0.0287282673402177,0.0246209591416104,0.0231623268661192,0.0235745037941668,0.019585457150271,0.0243062356489799,0.0143814953731778,0.014147834613636,0.0169520113777071,0.0171632481851458,0.0136340526769163,0.0147214987411443,0.011924251242889,0.0139956837286748,0.0105426218279829,0.0104825057661282,0.0125827824865109,0.00938455121008978,0.011083517178446,0.0108355421972353,0.0106034316005537,0.007951358500064,0.0104305319120703,0.00984764605139797,0.00905206986408543,0.00814223365954097,0.00736867944968346,0.00990181952708613,0.00881554516887922,0.00731246044524206,0.00694695202635282,0.0096613013284905,0.00736824916742456,0.00660680065544221,0.00817191220964427,0.00678686566699899,0.00758039542221011,0.00715763340762353,0.00636618640719721,0.00730898628332969,0.00684089599051735,0.00742401846161594,0.005941767327289,0.00608850244891824,0.00595796063964804,0.00779806638343764,0.00650685924016613,0.00588503321263015,0.00595204408101766,0.00629742328220161,0.00595566211053992,0.00584537239969455,0.00595638621294384,0.00560624637939506,0.00614083990696177,0.00542095758469916,0.00623934445580201,0.00527447890857099,0.00577418192182772,0.00529356202465082,0.00624484328086327,0.00523579012660837,0.00536483481952178,0.00494825657963475,0.00553478234534597,0.00524154909087658,0.0054762173606113,0.00501766640246483,0.00574295389297475,0.00505262651327578,0.00510036947621161,0.0047753866199714,0.00542404601090004,0.00481844016514642,0.00498907233350311,0.00468955744346129,0.00562792069847776,0.00486203075429002,0.00478589284221612,0.0045109548011153,0.00477727910668301,0.00504041833417298,0.00505844434786741,0.00445049671460206,0.00443924382802188,0.00474086537305229,0.00483476629361212,0.00475982892017534,0.00462218799549136,0.00457602072511713,0.00469537456918458,0.00435891338319772,0.00413371177447397,0.00468450513302589,0.00458550170050849,0.00492134495779961,0.00430327438164757,0.00448999828679961,0.0044614959605457,0.00444577908866546,0.00457797998154605,0.00421859517134749,0.0044758916409948,0.00432500518240517,0.00452426119141545,0.00429460202867681,0.00410616812780168,0.00442259129455904,0.00428799103989442,0.00419567960201143,0.00404635278994382,0.0042554948654919,0.00426735679893215,0.00416148323295657,0.00425869498051889,0.00422440201973463,0.00427972420963812,0.00423143208263865,0.00419641744595075,0.00409322075729349,0.00399081850889509,0.00444732178879009,0.00422331689431231,0.00408304997574897,0.00384066173141496,0.00397747592331097,0.00389351598679403,0.00401665817765628,0.0043025618123346,0.00414770051343982,0.00397698065958387,0.0048432556680061,0.00399742478126932,0.00372033339696221,0.00387425351787307,0.0041795130579477,0.00414666067775917,0.00453191764188405,0.00393652646964376,0.00387018644410923,0.00395973772608969,0.00393015745877353,0.00415437992841487,0.00382933470992191,0.0039716679840918,0.00396824920942686,0.00387720219926164,0.00390981839000382,0.00393403575344994,0.00400911152824456,0.00400428233275916,0.00410108797942429,0.00389587347791116,0.00410553253121395,0.00396849244418826,0.0039311613972831,0.0037751492481285,0.00369997445297613,0.00377118487646125,0.00395259752678043,0.00381772147934758,0.00394082444288075,0.00388465685945041,0.00375244315575771,0.00406008117671502,0.00379708664982422,0.00392388186823391,0.00373307086378985,0.00384811372148741,0.00375068091440866,0.00372059205998941,0.00399466736001566,0.00363512482761507,0.00391485419686484,0.00368820865268166,0.00366863626487896,0.00384054675727543,0.00393853595194595,0.0037268812904598,0.0038427928239601,0.00383807155374231,0.00374185560603772,0.00386633254827541,0.00370741683570314,0.00380710532992585,0.00360314981979589,0.00382845572788622,0.00378567651607456,0.00371504565701272,0.00375344787070957,0.00349840982111328,0.0036235098967868,0.00382352744452885,0.00387271559498584,0.0039850801128826,0.00369409574921024,0.00365402948740282,0.00356916834180024,0.003997670298266,0.00384850653112125,0.00375974113946744,0.00370689678198061,0.0035314564775711,0.0037728033925681,0.00371177593211664,0.00393531421706984,0.00349463113877538,0.00354997041008099,0.00363850304614584,0.00380225967133687,0.0037029578549787,0.00371205559827275,0.0036784776446341,0.00375118543979186,0.00369031987779686,0.00358394785152742,0.00355048591269601,0.00360803100878992,0.0038628290637094,0.00355930661319937,0.00357286880581381,0.00347757594170552,0.00359404884654308,0.00359704705243565,0.00355282380924421,0.00356784624245701,0.0037609879225256,0.00406416638612581,0.00401284667494191,0.00372135175036096,0.0035699176284499,0.00347955397123019,0.0035688708706609,0.00361850670512855,0.00348924856712853,0.00346169060084027,0.00339090465904398,0.00380684639959759,0.00389129219592492,0.00379656606813314,0.003638682281994,0.00362379963425109,0.00388079058084213,0.00345223995052029],"mode":"markers+lines","name":"train","type":"scatter","line":{"fillcolor":"rgba(31,119,180,1)","color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250],"y":[0.113130182515766,0.0444057257200802,0.0338218030084468,0.0337244120276592,0.027331536401767,0.0364557297141497,0.0157365234755445,0.0291692470492813,0.0235388943375963,0.016200669220665,0.0135053610686114,0.0119417633101341,0.00908138040480939,0.0180051426750421,0.0133253474656483,0.0139230545127173,0.0104116877098221,0.0161815621687389,0.0125230169414216,0.0106743122957257,0.00760007130117398,0.0143167004562888,0.0099035017282418,0.00850743700960419,0.00717878109301368,0.00932246191889959,0.00590738908806426,0.00621336159330416,0.0100953698511723,0.00734541487401999,0.00638536928401718,0.00652404895057058,0.00586827295124329,0.0100054315727589,0.0061083025121723,0.00599097981639381,0.00755202676831397,0.00583035139858034,0.00525141097151998,0.00542777025330286,0.00662804129684707,0.00475702075120482,0.0062491231311548,0.0053191991373578,0.00509747187379533,0.00540304841949387,0.00773470320342814,0.00488077097617871,0.00396682598821736,0.00481351257090104,0.00472614678102596,0.00710446645989411,0.00461329800898867,0.0051235838847148,0.00438369798100991,0.00580310844613587,0.00440549986376286,0.00570570041650452,0.00450401735656085,0.00621462016155515,0.0045844218878354,0.00579371628051257,0.00419412402165897,0.00410679536742282,0.00489720166851241,0.00430854848765894,0.0045834147920086,0.00414083012143214,0.0042575186627892,0.00438880844402387,0.00414000583374672,0.00436463447736572,0.00459588464141527,0.00419612045676621,0.00439515595620508,0.00479609852417636,0.0042723162559345,0.00409072977901828,0.00405593545176247,0.00410706908214842,0.00439099791108274,0.00387494988034584,0.00439228765373238,0.00399355074141957,0.00401882410493663,0.00366608608026613,0.00416154603545796,0.00429604800256609,0.00408634602138072,0.0036457710327475,0.0038686886909912,0.00346111863093953,0.00388235457257204,0.00387680105018709,0.00399573653650492,0.00382560213946689,0.00337296962423323,0.00372184353267049,0.00346486367434406,0.00397117702628571,0.00400618186329312,0.00380622913511325,0.00361856206184005,0.00377892771919154,0.00342203892918399,0.00406181423739448,0.00391573619066277,0.00327974044037212,0.00354338683975253,0.00385348058759944,0.00402818529869423,0.00345991293438781,0.00388654259999157,0.00339701492761596,0.00394133561925466,0.00333588686899319,0.00355539058167544,0.00341764174424356,0.00350320748511084,0.00362308836579378,0.00350471760626365,0.00315726500655526,0.00418935744581234,0.00357727754711535,0.00377469891027906,0.0032124473684468,0.00309793966649679,0.00400174808986976,0.00378790080931198,0.00319997678876343,0.00323269067461629,0.00327772157531511,0.00331256283992193,0.00396710460445582,0.00349006494403496,0.00352518252591228,0.00438439671334852,0.0033155192813655,0.00305584117067606,0.00308171310668691,0.00372226059455552,0.00414834133234933,0.0036536045417273,0.00326043397461808,0.00311625598944648,0.00325446621411817,0.00352779959533281,0.00349385066837333,0.00306241084715043,0.00310679940165032,0.00374772846732092,0.00318451340979581,0.00329561744235117,0.00330606148911825,0.00328602631159355,0.00356142912660462,0.0036566178696882,0.00298016473506014,0.00346005558228419,0.00387039451806239,0.003509293810439,0.00298505193366807,0.00308524231898947,0.00334737252893034,0.00331846410592868,0.00330092487563198,0.00332656265570132,0.0033720732555423,0.00335066726197344,0.00344379536055083,0.00312609378824259,0.00324478291796488,0.00355237458124654,0.00328325497746058,0.00298604643536463,0.0032389572100504,0.00394479379918898,0.00328576302131741,0.00343318496765189,0.0032109902348282,0.00307284749841439,0.00316588677773783,0.00345901292039913,0.00298842881271187,0.00336015376349717,0.00347437508324957,0.00334728942972399,0.00336315130138531,0.00352460209669757,0.0032865606651712,0.00339919040400945,0.00296591406744895,0.00333414175891829,0.00297110603255923,0.00342042933304478,0.00317143301693886,0.00297967699078887,0.00314434327325191,0.0031284324680681,0.00347351356675499,0.00346520464189259,0.0033189482529334,0.00330445941450954,0.00302716074080892,0.00331388459419681,0.00301531240399274,0.00334383082762795,0.00319390918530469,0.00324831062057816,0.00349794170534417,0.0030113330657014,0.00292862572725525,0.00302644708398229,0.00306803241079014,0.00305794025934832,0.00375350200255442,0.00347036088909677,0.0030349994790851,0.00291210345186323,0.00314275899766009,0.00324303559264062,0.00310634545764647,0.00305659554191634,0.00306083135925001,0.00297573860504961,0.00298781143941616,0.00293716110535653,0.00313474030756598,0.0033867360277322,0.00310669568716213,0.00302639104400015,0.00303997239733585,0.00375164709368625,0.00362943862941238,0.00342383155249971,0.00292799241341045,0.00300734343217194,0.00279084925786007,0.00319735809568368,0.00289800849230057,0.00291770640086851,0.0029085394475791,0.00337176571889986,0.00364597939504492,0.00371845556500285,0.00326496243670963,0.00349652030391568,0.00315407799410295,0.00304888271552164,0.00294715372065976],"mode":"markers+lines","name":"eval","type":"scatter","line":{"fillcolor":"rgba(255,127,14,1)","color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
</div>
<div id="inference-on-test-data" class="section level2">
<h2>Inference on test data</h2>
<p>Setup inference data. Need to apply preprocessing to inference sequence and convert into a infer data iterator.</p>
<div id="build-the-inference-symbols" class="section level3">
<h3>Build the inference symbols</h3>
<p>Two symbols:</p>
<ul>
<li>first unrolled to the length of the inference sequence.</li>
<li>second of length one on which to iterate up to the number of the desired inference steps.</li>
</ul>
<pre class="r"><code>ctx &lt;- mx.cpu()

pred_length = 80
data = mx.nd.array(x[, , 1, drop = F])
infer_length_ini &lt;- dim(data)[2]

symbol.infer.ini &lt;- rnn.graph.unroll(seq_len = infer_length_ini,
                                     num_rnn_layer = 2, 
                                     num_hidden = 50,
                                     input_size = NULL,
                                     num_embed = NULL, 
                                     num_decode = 1,
                                     masking = F, 
                                     loss_output = &quot;linear&quot;,
                                     dropout = 0, 
                                     ignore_label = -1,
                                     cell_type = &quot;lstm&quot;,
                                     output_last_state = T,
                                     config = &quot;one-to-one&quot;)

symbol.infer &lt;- rnn.graph.unroll(seq_len = 1,
                                 num_rnn_layer = 2, 
                                 num_hidden = 50,
                                 input_size = NULL,
                                 num_embed = NULL, 
                                 num_decode = 1,
                                 masking = F, 
                                 loss_output = &quot;linear&quot;,
                                 dropout = 0, 
                                 ignore_label = -1,
                                 cell_type = &quot;lstm&quot;,
                                 output_last_state = T,
                                 config = &quot;one-to-one&quot;)</code></pre>
</div>
<div id="inference" class="section level3">
<h3>Inference</h3>
<pre class="r"><code>predict &lt;- numeric()

infer &lt;- mx.infer.rnn.one.unroll(infer.data = data, 
                                 symbol = symbol.infer.ini,
                                 num_hidden = 50,
                                 arg.params = model$arg.params,
                                 aux.params = model$aux.params,
                                 init_states = NULL,
                                 ctx = ctx)

pred = mx.nd.array(y[seq_len, 1, drop = F])
real = sin(seeds[1] + pi/12 * (seq_len+1):(seq_len+pred_length))

for (i in 1:pred_length) {
  
  data = mx.nd.reshape(pred, shape = c(1,1,1))
  
  infer &lt;- mx.infer.rnn.one.unroll(infer.data = data, 
                                   symbol = symbol.infer,
                                   num_hidden = 50,
                                   arg.params = model$arg.params,
                                   aux.params = model$aux.params,
                                   init_states = infer[-1],
                                   ctx = ctx)
  
  pred &lt;- infer[[1]]
  predict &lt;- c(predict, as.numeric(as.array(pred)))
}</code></pre>
</div>
<div id="plot-predictions-against-real-values" class="section level3">
<h3>Plot predictions against real values</h3>
<pre class="r"><code>data = mx.nd.array(x[, , 1, drop = F])
label = mx.nd.array(y[, 1, drop = F])

plot_ly(x = 1:dim(y)[1], y = y[,1], type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;hist&quot;) %&gt;% 
  add_trace(x = dim(y)[1] + 1:length(real), y = real, type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;real&quot;) %&gt;% 
  add_trace(x = dim(y)[1] + 1:length(predict), y = predict, type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;pred&quot;)</code></pre>
<div id="2101e0a791a" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="2101e0a791a">{"x":{"visdat":{"21021ef2d9a":["function () ","plotlyVisDat"]},"cur_data":"21021ef2d9a","attrs":{"21021ef2d9a":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.141673324313635,-0.393054380725565,-0.617649430644124,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907408,-0.372264034855726,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644124,0.800152692578232,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514343,0.599796355907409,0.372264034855726,0.119362535024032,-0.141673324313634,-0.393054380725564,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.372264034855728,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644123,0.800152692578231,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514345,0.599796355907409,0.372264034855728,0.119362535024032,-0.141673324313634,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.37226403485573,-0.119362535024034,0.141673324313634,0.393054380725566,0.61764943064412,0.80015269257823,0.928126870827978,0.992850736632973,0.98991346549985,0.919515227602265,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907412,-0.37226403485573,-0.119362535024034,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578232],"mode":"lines","name":"hist","alpha":1,"sizes":[10,100],"type":"scatter"},"21021ef2d9a.1":{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[-0.928126870827976,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907412,-0.37226403485573,-0.119362535024035,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.989913465499851,0.919515227602266,0.786453546514346,0.59979635590741,0.372264034855727,0.119362535024038,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578231,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907407,-0.37226403485573,-0.119362535024035,0.141673324313633,0.393054380725565,0.617649430644125,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.59979635590741,0.372264034855727,0.119362535024031,-0.141673324313629,-0.393054380725562,-0.617649430644122,-0.800152692578231,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907407,-0.372264034855731,-0.119362535024035,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.59979635590741,0.372264034855727,0.119362535024032,-0.141673324313629,-0.393054380725561,-0.617649430644122,-0.800152692578231,-0.928126870827978,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907413,-0.372264034855731,-0.119362535024035],"mode":"lines","name":"real","alpha":1,"sizes":[10,100],"type":"scatter"},"21021ef2d9a.2":{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[-0.990632772445679,-1.06699001789093,-1.06149554252625,-0.977517127990723,-0.84306126832962,-0.679135084152222,-0.492153525352478,-0.291260302066803,-0.0747886300086975,0.165536507964134,0.388066917657852,0.596980035305023,0.778410494327545,0.908053338527679,0.985426008701324,0.976243615150452,0.89776748418808,0.743618428707123,0.51288115978241,0.245760291814804,-0.0515448078513145,-0.33743092417717,-0.614549338817596,-0.824923515319824,-0.971263468265533,-1.05964457988739,-1.06474554538727,-0.998551070690155,-0.871774315834045,-0.712404012680054,-0.529674351215363,-0.332360029220581,-0.122028797864914,0.113247878849506,0.34518101811409,0.551908791065216,0.746570944786072,0.882974624633789,0.976715624332428,0.983975112438202,0.920489549636841,0.781603574752808,0.565234839916229,0.302461385726929,0.0126253608614206,-0.281993418931961,-0.558678269386292,-0.789925813674927,-0.943888485431671,-1.04960155487061,-1.06763005256653,-1.02004504203796,-0.900503277778625,-0.746337234973907,-0.568173348903656,-0.373353719711304,-0.166829198598862,0.0627622678875923,0.301752299070358,0.507991433143616,0.712321698665619,0.857255637645721,0.964116275310516,0.988828241825104,0.939175486564636,0.81546413898468,0.614980340003967,0.357397466897964,0.0749279633164406,-0.226859644055367,-0.502619385719299,-0.752803325653076,-0.916004240512848,-1.03558421134949,-1.06862378120422,-1.03730154037476,-0.926484525203705,-0.778532862663269,-0.605327606201172,-0.413283348083496],"mode":"lines","name":"pred","alpha":1,"sizes":[10,100],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1]},"yaxis":{"domain":[0,1]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.141673324313635,-0.393054380725565,-0.617649430644124,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907408,-0.372264034855726,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644124,0.800152692578232,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514343,0.599796355907409,0.372264034855726,0.119362535024032,-0.141673324313634,-0.393054380725564,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632973,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.372264034855728,-0.119362535024032,0.141673324313634,0.393054380725564,0.617649430644123,0.800152692578231,0.928126870827978,0.992850736632973,0.989913465499851,0.919515227602264,0.786453546514345,0.599796355907409,0.372264034855728,0.119362535024032,-0.141673324313634,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827978,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907409,-0.37226403485573,-0.119362535024034,0.141673324313634,0.393054380725566,0.61764943064412,0.80015269257823,0.928126870827978,0.992850736632973,0.98991346549985,0.919515227602265,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578232,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907412,-0.37226403485573,-0.119362535024034,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.599796355907409,0.372264034855727,0.119362535024031,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578232],"mode":"lines","name":"hist","type":"scatter","line":{"fillcolor":"rgba(31,119,180,1)","color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[-0.928126870827976,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907412,-0.37226403485573,-0.119362535024035,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.989913465499851,0.919515227602266,0.786453546514346,0.59979635590741,0.372264034855727,0.119362535024038,-0.14167332431363,-0.393054380725562,-0.617649430644123,-0.800152692578231,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907407,-0.37226403485573,-0.119362535024035,0.141673324313633,0.393054380725565,0.617649430644125,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.59979635590741,0.372264034855727,0.119362535024031,-0.141673324313629,-0.393054380725562,-0.617649430644122,-0.800152692578231,-0.928126870827979,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907407,-0.372264034855731,-0.119362535024035,0.141673324313633,0.393054380725565,0.61764943064412,0.800152692578229,0.928126870827977,0.992850736632973,0.98991346549985,0.919515227602266,0.786453546514346,0.59979635590741,0.372264034855727,0.119362535024032,-0.141673324313629,-0.393054380725561,-0.617649430644122,-0.800152692578231,-0.928126870827978,-0.992850736632972,-0.989913465499851,-0.919515227602264,-0.786453546514344,-0.599796355907413,-0.372264034855731,-0.119362535024035],"mode":"lines","name":"real","type":"scatter","line":{"fillcolor":"rgba(255,127,14,1)","color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[-0.990632772445679,-1.06699001789093,-1.06149554252625,-0.977517127990723,-0.84306126832962,-0.679135084152222,-0.492153525352478,-0.291260302066803,-0.0747886300086975,0.165536507964134,0.388066917657852,0.596980035305023,0.778410494327545,0.908053338527679,0.985426008701324,0.976243615150452,0.89776748418808,0.743618428707123,0.51288115978241,0.245760291814804,-0.0515448078513145,-0.33743092417717,-0.614549338817596,-0.824923515319824,-0.971263468265533,-1.05964457988739,-1.06474554538727,-0.998551070690155,-0.871774315834045,-0.712404012680054,-0.529674351215363,-0.332360029220581,-0.122028797864914,0.113247878849506,0.34518101811409,0.551908791065216,0.746570944786072,0.882974624633789,0.976715624332428,0.983975112438202,0.920489549636841,0.781603574752808,0.565234839916229,0.302461385726929,0.0126253608614206,-0.281993418931961,-0.558678269386292,-0.789925813674927,-0.943888485431671,-1.04960155487061,-1.06763005256653,-1.02004504203796,-0.900503277778625,-0.746337234973907,-0.568173348903656,-0.373353719711304,-0.166829198598862,0.0627622678875923,0.301752299070358,0.507991433143616,0.712321698665619,0.857255637645721,0.964116275310516,0.988828241825104,0.939175486564636,0.81546413898468,0.614980340003967,0.357397466897964,0.0749279633164406,-0.226859644055367,-0.502619385719299,-0.752803325653076,-0.916004240512848,-1.03558421134949,-1.06862378120422,-1.03730154037476,-0.926484525203705,-0.778532862663269,-0.605327606201172,-0.413283348083496],"mode":"lines","name":"pred","type":"scatter","line":{"fillcolor":"rgba(44,160,44,1)","color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
